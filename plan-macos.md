# macOS App å¼€å‘è®¡åˆ’ (Phase 1)

## é¡¹ç›®æ¦‚è¿°

macOS èœå•æ /Dock åº”ç”¨ï¼Œæä¾›æˆªå›¾ç¿»è¯‘å’Œæœ¬åœ°å•è¯æœ¬åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ |
|------|----------|
| UI æ¡†æ¶ | SwiftUI |
| æ•°æ®æŒä¹…åŒ– | SwiftData |
| OCR | Vision Framework (VNRecognizeTextRequest) |
| ç¿»è¯‘ | Apple Translation Framework |
| æˆªå›¾ | ScreenCaptureKit |
| å¿«æ·é”® | NSEvent Global/Local Monitor |

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AppDelegate                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ NSStatusItemâ”‚  â”‚ Global      â”‚  â”‚ Window Management   â”‚ â”‚
â”‚  â”‚ (Menu Bar)  â”‚  â”‚ Hotkey      â”‚  â”‚                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AppState                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ScreenshotTranslateViewModel            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚Screenshot â”‚ â”‚   OCR    â”‚ â”‚   Translation     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Service   â”‚ â”‚ Service  â”‚ â”‚     Service       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               WordBookViewModel                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              WordBookManager                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚           (SwiftData CRUD)                     â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. æˆªå›¾ç¿»è¯‘æµç¨‹

```
fn+F1 å¿«æ·é”®
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¨å±é€‰åŒºè¦†ç›–å±‚   â”‚ â† SelectionOverlayWindow (NSWindow, level: .floating)
â”‚ ç”¨æˆ·æ‹–æ‹½é€‰æ‹©åŒºåŸŸ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ESC å–æ¶ˆ / æ‹–æ‹½å®Œæˆ
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScreenCaptureKitâ”‚ â† æ•è·é€‰ä¸­åŒºåŸŸæˆªå›¾ (CGImage)
â”‚ æˆªå›¾æ•è·         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vision OCR      â”‚ â† VNRecognizeTextRequest æå–æ–‡å­—
â”‚ æ–‡å­—è¯†åˆ«         â”‚   æ”¯æŒä¸­è‹±æ–‡è‡ªåŠ¨è¯†åˆ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apple Translate â”‚ â† TranslationSession (via SwiftUI bridge)
â”‚ ç¿»è¯‘             â”‚   è‡ªåŠ¨æ£€æµ‹æºè¯­è¨€ â†’ ä¸­æ–‡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»“æœå±•ç¤ºçª—å£     â”‚ â† TranslationResultWindow (NSPanel)
â”‚ åŸæ–‡ + è¯‘æ–‡      â”‚   å¯æ”¶è—åˆ°å•è¯æœ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å•è¯æœ¬åŠŸèƒ½

- SwiftData æœ¬åœ°æŒä¹…åŒ–
- æ”¯æŒæœç´¢ã€åˆ é™¤
- è®°å½•æ¥æº (screenshot/webpage/video)
- åç»­å¯é€šè¿‡ Firebase äº‘åŒæ­¥

## æ–‡ä»¶ç»“æ„

```
TranslatorApp/
â”œâ”€â”€ TranslatorApp.xcodeproj
â”œâ”€â”€ TranslatorApp/
â”‚   â”œâ”€â”€ App/
â”‚   â”‚   â”œâ”€â”€ TranslatorAppApp.swift      # å…¥å£ + AppDelegate
â”‚   â”‚   â””â”€â”€ AppState.swift              # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ Core/
â”‚   â”‚   â”œâ”€â”€ Errors/
â”‚   â”‚   â”‚   â””â”€â”€ TranslatorError.swift   # ç»Ÿä¸€é”™è¯¯ç±»å‹
â”‚   â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”‚   â””â”€â”€ Word.swift              # SwiftData æ¨¡å‹
â”‚   â”‚   â””â”€â”€ Services/
â”‚   â”‚       â”œâ”€â”€ Protocols.swift         # æœåŠ¡åè®®å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ ScreenshotService.swift # æˆªå›¾æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ OCRService.swift        # OCR æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ TranslationService.swift# ç¿»è¯‘æœåŠ¡
â”‚   â”‚       â””â”€â”€ WordBookManager.swift   # å•è¯æœ¬ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ Features/
â”‚   â”‚   â”œâ”€â”€ ScreenshotTranslate/
â”‚   â”‚   â”‚   â”œâ”€â”€ ScreenshotTranslateViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionOverlayWindow.swift
â”‚   â”‚   â”‚   â””â”€â”€ TranslationResultWindow.swift
â”‚   â”‚   â””â”€â”€ WordBook/
â”‚   â”‚       â”œâ”€â”€ WordBookViewModel.swift
â”‚   â”‚       â””â”€â”€ WordBookView.swift
â”‚   â”‚
â”‚   â””â”€â”€ Info.plist
```

## æ•°æ®æ¨¡å‹

```swift
@Model
final class Word {
    @Attribute(.unique) var id: UUID
    var text: String           // åŸæ–‡
    var translation: String    // è¯‘æ–‡
    var source: String         // æ¥æº: screenshot, webpage, video
    var sourceURL: String?     // æ¥æº URL
    var tags: [String]         // æ ‡ç­¾
    var createdAt: Date        // åˆ›å»ºæ—¶é—´
    var syncedAt: Date?        // åŒæ­¥æ—¶é—´
}
```

## æƒé™è¦æ±‚

| æƒé™ | ç”¨é€” | Info.plist Key |
|------|------|----------------|
| å±å¹•å½•åˆ¶ | ScreenCaptureKit æˆªå›¾ | NSScreenCaptureUsageDescription |
| è¾…åŠ©åŠŸèƒ½ | å…¨å±€å¿«æ·é”®ç›‘å¬ | ç³»ç»Ÿè®¾ç½®æ‰‹åŠ¨æˆæƒ |

## å·²å®ŒæˆåŠŸèƒ½ âœ…

- [x] é¡¹ç›®ç»“æ„æ­å»º
- [x] èœå•æ /Dock åº”ç”¨æ¡†æ¶
- [x] å…¨å±€å¿«æ·é”® fn+F1
- [x] æˆªå›¾é€‰åŒºåŠŸèƒ½ (SelectionOverlayWindow)
- [x] ScreenCaptureKit æˆªå›¾
- [x] Vision OCR æ–‡å­—è¯†åˆ«
- [x] Apple Translation ç¿»è¯‘
- [x] ç¿»è¯‘ç»“æœå±•ç¤ºçª—å£
- [x] æ”¶è—åˆ°å•è¯æœ¬
- [x] å•è¯æœ¬ç•Œé¢ (WordBookView)
- [x] SwiftData æŒä¹…åŒ–

## å·²ä¿®å¤é—®é¢˜ ğŸ”§

1. **ç³»ç»Ÿæ­»é”**: é€‰åŒºçª—å£ level ä» `.screenSaver` æ”¹ä¸º `.floating`
2. **é”®ç›˜ç›‘å¬æ³„æ¼**: æ·»åŠ  `cleanupKeyboardMonitor()` æ¸…ç†
3. **é€‰æ‹©è¶…æ—¶**: æ·»åŠ  60 ç§’è¶…æ—¶æœºåˆ¶
4. **çª—å£æ¶ˆå¤±**: æ·»åŠ  `resultWindow` å¼ºå¼•ç”¨é˜²æ­¢é‡Šæ”¾
5. **Translation API**: ä½¿ç”¨ SwiftUI `.translationTask` bridge æ¨¡å¼

## å¾…ä¼˜åŒ–é¡¹ç›® ğŸ“‹

- [ ] èœå•æ å›¾æ ‡åœ¨ macOS 26 æ˜¾ç¤ºé—®é¢˜
- [ ] å¤šæ˜¾ç¤ºå™¨æ”¯æŒ
- [ ] å†å²è®°å½•æŸ¥çœ‹
- [ ] å¿«æ·é”®è‡ªå®šä¹‰
- [ ] ç¿»è¯‘ç›®æ ‡è¯­è¨€è®¾ç½®

## åç»­é˜¶æ®µ

### Phase 2: Chrome Extension é›†æˆ
- Native Messaging Host
- æ¥æ”¶ Chrome æ‰©å±•ç¿»è¯‘è¯·æ±‚
- ç½‘é¡µå•è¯æ”¶è—åŒæ­¥

### Phase 3: è§†é¢‘å­—å¹•ç¿»è¯‘
- YouTube å­—å¹•æå–
- Bilibili å­—å¹•ç¿»è¯‘

### Phase 4: Flutter äº‘åŒæ­¥
- Firebase Firestore é›†æˆ
- å¤šè®¾å¤‡å•è¯æœ¬åŒæ­¥
